<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAxNiIgd2lkdGg9IjMyIiBoZWlnaHQ9IjE2Ij4KICA8cmVjdCB4PSIwIiAgeT0iMCIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iI0ZGRTBBMCIvPgogIDxyZWN0IHg9IjgiICB5PSIwIiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjRkZDMDQwIi8+CiAgPHJlY3QgeD0iMTYiIHk9IjAiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiNGRjhDMDAiLz4KICA8cmVjdCB4PSIyNCIgeT0iMCIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iI0UwNjgwMCIvPgogIDxyZWN0IHg9IjAiICB5PSI4IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjRkZCMDIwIi8+CiAgPHJlY3QgeD0iOCIgIHk9IjgiIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIGZpbGw9IiNGRjhDMDAiLz4KICA8cmVjdCB4PSIxNiIgeT0iOCIgd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsbD0iI0I4NEUwMCIvPgogIDxyZWN0IHg9IjI0IiB5PSI4IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjOEMzODAwIi8+Cjwvc3ZnPg==">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secret Vending Machine</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Serif+Display:ital@0;1&family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Righteous&family=Libre+Baskerville:ital@1&family=Permanent+Marker&family=Pacifico&family=Lora:ital,wght@0,400;0,600;1,400&family=Inter:wght@700&family=Fraunces:ital,opsz,wght@0,9..144,100..900;1,9..144,100..900&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #39FF14;
    --black: #0a0a0a;
    --white: #f5f5f0;
    --muted: #888;
    --header-bg: #f5f5f0;
    --charcoal: #1a1a1a;

    /* Warm ink palette — pulled from the press mark squares */
    --ink-ochre:    #F6A800;   /* saffron — logo box border */
    --ink-sienna:   #C1440E;   /* burnt sienna — tagline bar, accents */
    --ink-vermil:   #E8470A;   /* vermillion */
    --ink-cream:    #F7D98B;   /* ochre cream */
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'Courier Prime', monospace;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    background: var(--header-bg);
    color: var(--black);
    padding: 2rem 4rem 1.5rem 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    position: relative;
  }

  /* The 3px black bottom border */
  header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--black);
  }

  /* Dashed green cut line — sits just above the black border.
     Like a coupon perforation. The trim line. */
  header::before {
    content: '';
    position: absolute;
    bottom: 8px;
    left: 0;
    right: 40%; /* ends 60% across — leaves bottom-left negative space deliberate */
    height: 3px;
    background-image: repeating-linear-gradient(
      to right,
      #FF8C00 0px,
      #FF8C00 18px,
      transparent 18px,
      transparent 30px
    );
    opacity: 0.85;
  }

  .header-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 2rem;
    position: relative;
  }

  .header-bottom {
    display: flex;
    justify-content: flex-end;
    margin-right: -4rem; /* bleed to right edge, cancelling header padding */
    padding-right: 4rem;
  }

  /* ── LOGO WRAP ──
     Just the box — press mark is now absolutely positioned in header corner */
  .logo-wrap {
    display: inline-block;
    /* no position:relative — press-mark positions to header-top */
  }

  /* ── GREEN BORDER BOX ── */
  .title-box {
    display: inline-block;
    border: none;
    border-bottom: none; /* bottom bar handled by pseudo-element below */
    padding: 0.5rem 0.78rem 0rem; /* tighter bottom so descender breaks through */
    position: relative;
  }

  /* The thick mango base — sits behind the text so the "g" descender pierces it */
  .title-box::after {
    content: '';
    position: absolute;
    bottom: -4px; /* sits just below the text baseline */
    left: -1.5px;
    right: -1.5px;
    height: 4px;
    background: #FF8C00;
    z-index: 0; /* text renders above this */
  }

  /* Ensure the text stack renders above the base bar */
  .title-stack {
    display: flex;
    flex-direction: column;
    line-height: 0.9;
    gap: 0;
    position: relative;
    z-index: 1;
  }

  /* Bottom row: Vending + Machine side by side */
  .title-row {
    display: flex;
    align-items: baseline;
    gap: 0.18em;
  }

  /* ── LOGO: Fraunces italic — one voice, three sizes ── */
  .title-stack .word {
    display: block;
    color: #0a0a0a;
    line-height: 0.95;
    font-family: 'Fraunces', serif;
    font-style: italic;
    font-variation-settings: 'opsz' 144, 'WONK' 1;
  }

  /* SECRET — declares itself */
  .word-secret {
    font-weight: 900;
    font-size: clamp(3.5rem, 7vw, 6.5rem);
    letter-spacing: -0.03em;
  }

  /* VENDING — follows proportionally */
  .word-vending {
    font-weight: 500;
    font-size: clamp(1.6rem, 3.2vw, 2.8rem);
    letter-spacing: -0.01em;
  }

  /* MACHINE — same as vending */
  .word-machine {
    font-weight: 500;
    font-size: clamp(1.6rem, 3.2vw, 2.8rem);
    letter-spacing: -0.01em;
  }

  /* ── PRESS MARK ──
     2×4 grid of warm ink squares, top-right corner of header.
     Each square is equal width and height — true squares. */
  .press-mark {
    position: absolute;
    top: 0;
    right: 0;
    display: grid;
    grid-template-columns: repeat(4, 18px);
    grid-template-rows: repeat(2, 18px);
    gap: 0;
  }

  .press-mark span {
    display: block;
    width: 18px;
    height: 18px;
  }

  /* 8 successive mango tones — cream to deep burnt */
  .pm-1 { background: #FFE0A0; }   /* mango cream */
  .pm-2 { background: #FFD070; }   /* pale mango */
  .pm-3 { background: #FFC040; }   /* light mango */
  .pm-4 { background: #FFB020; }   /* mango */
  .pm-5 { background: #FF8C00; }   /* pure mango — matches vend button */
  .pm-6 { background: #E06800; }   /* deep mango */
  .pm-7 { background: #B84E00; }   /* burnt mango */
  .pm-8 { background: #8C3800; }   /* dark mango bark */

  /* vertical line removed */

  /* Tagline */
  .tagline-block {
    text-align: right;
    padding-bottom: 0;
    margin-top: 0;
    align-self: flex-end; /* drops to bottom of header-top, just above nav */
    padding-right: 0;
  }

  .tagline {
    font-family: 'DM Serif Display', serif;
    font-style: italic;
    font-size: 0.75rem;  /* 25% smaller than 1rem */
    color: #444;
    letter-spacing: 0.01em;
    white-space: nowrap;
  }

  .tagline-bar {
    height: 1.5px;
    background: #FF8C00;
    width: 100%;
    margin-top: 5px;
  }

  /* NAV */
  nav {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  nav button {
    font-family: 'Space Mono', monospace;
    font-size: 0.72rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    border: none;
    background: transparent;
    cursor: pointer;
    display: inline-block;
    padding: 0.5rem 0.9rem;
    transition: all 0.15s;
  }

  .nav-regular {
    background: transparent;
    color: #888;
    border: none;
  }

  .nav-regular:hover {
    color: #FF8C00;
    background: transparent;
  }

  .nav-regular.active {
    color: #FF8C00;
    background: transparent;
    border-bottom: 2px solid #FF8C00;
  }

  .nav-zine {
    background: transparent;
    color: #FF8C00;
    border: 2px solid #FF8C00;
    font-size: 0.85rem;
    padding: 0.55rem 1.2rem;
  }

  .nav-zine:hover {
    background: #FF8C00;
    color: #fff;
    box-shadow: none;
  }

  .nav-vend {
    background: #FF8C00;
    color: #fff;
    border: 2px solid #FF8C00;
    font-size: 0.85rem;
    padding: 0.55rem 1.2rem;
  }

  .nav-vend:hover {
    background: #000;
    color: #FF8C00;
    box-shadow: none;
  }

  /* MAIN */
  main {
    max-width: 760px;
    margin: 0 auto;
    padding: 3rem 2rem 6rem;
  }

  /* About page breaks out of the constrained main column */
  #page-about {
    margin: -3rem -2rem -6rem;
    max-width: none;
    width: calc(100% + 4rem);
  }

  .page { display: none; }
  .page.active { display: block; }

  /* HOME */
  .home-label {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: #FF8C00;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .home-label::before {
    content: '';
    display: block;
    width: 24px;
    height: 2px;
    background: #FF8C00;
  }

  /* ── POST — lives on the page, no card, no box ── */

  .post-dateline {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .post-dateline::before {
    content: '';
    display: block;
    width: 20px;
    height: 2px;
    background: #FF8C00;
    flex-shrink: 0;
  }

  .post-dateline span {
    font-family: 'Space Mono', monospace;
    font-size: 0.62rem;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
  }

  /* No card — post lives directly on the page */
  .post-card {
    background: transparent;
    border: none;
    padding: 0;
    margin-bottom: 5rem;
  }

  .post-card h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 2rem;
    font-weight: 400;
    line-height: 1.15;
    margin-bottom: 1.5rem;
    color: var(--white);
    letter-spacing: -0.01em;
  }

  /* Image — constrained on desktop, full width on mobile */
  .post-card .post-img {
    display: block;
    width: 100%;
    max-width: 680px;
    height: auto;
    margin-bottom: 1.8rem;
  }

  .post-card .post-body {
    font-family: 'Fraunces', serif;
    font-weight: 400;
    font-style: normal;
    font-variation-settings: 'opsz' 12, 'WONK' 0;
    font-size: 1.05rem;
    line-height: 1.95;
    color: #bbb;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* Thin separator between posts */
  .post-separator {
    width: 40px;
    height: 1px;
    background: #FF8C00;
    opacity: 0.3;
    margin: 0 0 5rem 0;
  }

  /* Back button on single post page */
  .post-back {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    margin-bottom: 3rem;
    transition: color 0.15s;
  }

  .post-back:hover { color: #FF8C00; }

  /* ── SITE FOOTER ── */
  .site-footer {
    text-align: center;
    padding: 3rem 1rem 2rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    color: #333;
    text-transform: uppercase;
  }

  .site-footer a {
    color: #FF8C00;
    text-decoration: none;
    border-bottom: 1px solid rgba(255,140,0,0.3);
    transition: border-color 0.15s;
    display: inline-block;
    padding: 0.6rem 1rem;
    margin: -0.6rem -1rem;
  }

  .site-footer a:hover {
    border-color: #FF8C00;
  }

  .no-posts {
    text-align: center;
    padding: 5rem 1rem;
    color: var(--muted);
    font-style: italic;
  }

  .no-posts .hint {
    margin-top: 1rem;
    font-size: 0.8rem;
    letter-spacing: 0.05em;
    color: #555;
  }

  /* ARCHIVE */
  .archive-item {
    border-bottom: 1px solid #1e1e1e;
    padding: 1.2rem 0;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.15s;
  }

  .archive-item:hover { padding-left: 0.5rem; }
  .archive-item:hover .arch-title { color: var(--ink-ochre); }

  .arch-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.15rem;
    color: var(--white);
    transition: color 0.15s;
    flex: 1;
  }

  .arch-date {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .arch-date::before {
    content: '';
    display: block;
    width: 10px;
    height: 1.5px;
    background: #FF8C00;
    opacity: 0.5;
    flex-shrink: 0;
  }

  /* ABOUT */
  .about-content {
    font-size: 1.05rem;
    line-height: 1.95;
    color: #bbb;
  }

  .about-content p { margin-bottom: 1.2rem; }

  /* ── ABOUT PAGE LAYOUT ── */
  .about-section {
    width: 100%;
    padding: 4rem 4rem 4rem 2rem;
    border-bottom: 1px solid #1a1a1a;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
    position: relative;
  }

  .about-section:last-child { border-bottom: none; }

  .about-section::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 1px;
    background: #FF8C00;
    opacity: 0.4;
  }

  /* hover removed — no interactive affordance on a reading surface */

  /* SECRET — massive, full width, mango */
  .about-section-secret {
    grid-template-columns: 1fr;
  }

  .about-title-secret {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: clamp(3.25rem, 7.8vw, 6.5rem);
    color: #FF8C00;
    line-height: 0.9;
    letter-spacing: 0.04em;
    text-transform: lowercase;
    margin-bottom: 1.5rem;
  }

  /* VENDING — left sticky, text right */
  .about-title-vending {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: clamp(3rem, 6vw, 5rem);
    color: var(--white);
    line-height: 1;
    letter-spacing: 0.06em;
    text-transform: lowercase;
  }

  /* MACHINE — right-aligned, muted, dry */
  .about-section-machine {
    align-items: end;
  }

  .about-title-machine {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: clamp(1.6rem, 3vw, 2.2rem);
    color: #2a2a2a;
    line-height: 1;
    letter-spacing: 0.06em;
    text-transform: lowercase;
    text-align: right;
    grid-column: 2;
    grid-row: 1;
    align-self: end;
  }

  .about-section-machine .about-body {
    grid-column: 1;
    grid-row: 1;
  }

  /* Body text */
  .about-body {
    font-family: 'Fraunces', serif;
    font-weight: 400;
    font-style: normal;
    font-variation-settings: 'opsz' 12, 'WONK' 0;
    font-size: 1rem;
    line-height: 1.9;
    color: #c0c0c0;
  }

  .about-body p { margin-bottom: 1rem; }

  /* Closing printer's mark */
  .about-colophon {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 3rem 4rem;
    opacity: 0.3;
  }

  .about-colophon-rule {
    flex: 1;
    height: 1px;
    background: #FF8C00;
    display: block;
  }

  .about-colophon-mark {
    font-size: 0.5rem;
    color: #FF8C00;
    display: block;
    letter-spacing: 0;
  }

  /* SUBMIT FORM */
  /* ── SUBMIT PAGE ── */

  /* Big celebratory color grid at top of submit page */
  .submit-squares {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(3, 1fr);
    width: 100%;
    margin-bottom: 3rem;
    gap: 3px;
  }

  .submit-squares span {
    display: block;
    aspect-ratio: 1;
  }

  /* Three rows of mango gradient — lightest to darkest, repeating warmly */
  .ss-1  { background: #FFE0A0; }
  .ss-2  { background: #FFD070; }
  .ss-3  { background: #FFC040; }
  .ss-4  { background: #FFB020; }
  .ss-5  { background: #FF8C00; }
  .ss-6  { background: #E06800; }
  .ss-7  { background: #B84E00; }
  .ss-8  { background: #8C3800; }
  .ss-9  { background: #FFD070; }
  .ss-10 { background: #FFC040; }
  .ss-11 { background: #FFB020; }
  .ss-12 { background: #FF8C00; }
  .ss-13 { background: #E06800; }
  .ss-14 { background: #B84E00; }
  .ss-15 { background: #8C3800; }
  .ss-16 { background: #FFE0A0; }
  .ss-17 { background: #FFC040; }
  .ss-18 { background: #FFB020; }
  .ss-19 { background: #FF8C00; }
  .ss-20 { background: #E06800; }
  .ss-21 { background: #B84E00; }
  .ss-22 { background: #8C3800; }
  .ss-23 { background: #FFE0A0; }
  .ss-24 { background: #FFD070; }

  /* Intro text — sets the emotional register */
  .submit-intro {
    font-family: 'Fraunces', serif;
    font-weight: 400;
    font-variation-settings: 'opsz' 12, 'WONK' 0;
    font-size: 1.1rem;
    line-height: 1.9;
    color: #888;
    margin-bottom: 3rem;
    max-width: 520px;
    border-left: 1px solid #FF8C00;
    padding-left: 1.5rem;
  }

  /* Submit heading — Inter 700 like about page titles */
  .submit-heading {
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: clamp(3rem, 7vw, 5.5rem);
    letter-spacing: 0.05em;
    text-transform: lowercase;
    color: var(--white);
    line-height: 1;
    margin-bottom: 2rem;
  }

  .submit-heading span {
    color: #FF8C00;
  }

  .form-group {
    margin-bottom: 2rem;
    position: relative;
  }

  /* Field number — like a form in a magazine */
  .form-group .field-num {
    font-family: 'Space Mono', monospace;
    font-size: 0.55rem;
    letter-spacing: 0.2em;
    color: #FF8C00;
    opacity: 0.6;
    margin-bottom: 0.4rem;
    display: block;
  }

  label {
    display: block;
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: lowercase;
    color: #ccc;
    margin-bottom: 0.6rem;
  }

  input[type="text"],
  input[type="email"],
  textarea {
    width: 100%;
    background: transparent;
    border: none;
    border-bottom: 1px solid #2a2a2a;
    color: var(--white);
    font-family: 'Fraunces', serif;
    font-weight: 400;
    font-variation-settings: 'opsz' 12, 'WONK' 0;
    font-size: 1rem;
    padding: 0.6rem 0;
    outline: none;
    transition: border-color 0.2s;
    box-sizing: border-box;
  }

  input[type="text"]:focus,
  input[type="email"]:focus,
  textarea:focus {
    border-bottom-color: #FF8C00;
  }

  input::placeholder,
  textarea::placeholder {
    color: #333;
    font-style: italic;
  }

  textarea {
    min-height: 180px;
    resize: none;
    line-height: 1.8;
    display: block;
  }

  .field-note {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    color: #444;
    letter-spacing: 0.08em;
    margin-top: 0.5rem;
  }

  /* Submit button — mango, full width, considered */
  .btn-submit {
    background: #FF8C00;
    color: #000;
    border: none;
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: lowercase;
    padding: 1.1rem 2rem;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    margin-top: 1rem;
  }

  .btn-submit:hover {
    background: var(--white);
    color: #000;
  }

  .btn-submit:disabled { opacity: 0.4; cursor: not-allowed; }

  .success-msg {
    background: transparent;
    border: none;
    color: #FF8C00;
    padding: 4rem 0 2rem;
    font-family: 'Fraunces', serif;
    font-style: italic;
    font-weight: 900;
    font-variation-settings: 'opsz' 144, 'WONK' 1;
    font-size: clamp(4rem, 12vw, 8rem);
    letter-spacing: -0.02em;
    text-align: center;
    margin-bottom: 2rem;
    display: none;
  }

  .error-msg {
    background: transparent;
    border-left: 3px solid #ff3c3c;
    color: #ff3c3c;
    padding: 1rem 1.5rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
    margin-bottom: 1.5rem;
    display: none;
  }

  .field-note {
    margin-top: 0.4rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.62rem;
    color: #555;
    letter-spacing: 0.04em;
  }

  /* VEND MODAL */
  #vend-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    z-index: 100;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  #vend-overlay.open {
    display: flex;
    animation: fadeIn 0.25s ease;
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  #vend-card {
    background: #0f0f0f;
    border: 1px solid #2a2a2a;
    border-top: 3px solid var(--ink-sienna);
    max-width: 680px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    padding: 2.5rem;
    position: relative;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .vend-label {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.25em;
    color: var(--ink-ochre);
    text-transform: uppercase;
    margin-bottom: 1.5rem;
  }

  #close-vend {
    position: absolute;
    top: 1.2rem;
    right: 1.2rem;
    background: transparent;
    border: 1px solid #333;
    color: var(--muted);
    cursor: pointer;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.1em;
    padding: 0.3rem 0.6rem;
    transition: all 0.15s;
  }

  #close-vend:hover { border-color: var(--white); color: var(--white); }

  .page-header {
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #1a1a1a;
  }

  .page-header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 2.2rem;
    font-weight: 400;
    color: var(--white);
  }

  .page-header .sub {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-top: 0.4rem;
  }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: #0a0a0a; }
  ::-webkit-scrollbar-thumb { background: #333; }
  ::-webkit-scrollbar-thumb:hover { background: var(--ink-sienna); }

  @media (max-width: 700px) {

    /* ── HEADER ── */
    header {
      padding: 1.2rem 1.2rem 1rem;
    }

    header::before {
      right: 55%;       /* partial — same deliberate negative space as desktop */
      height: 2px;      /* slightly smaller on mobile */
      background-image: repeating-linear-gradient(
        to right,
        #FF8C00 0px,
        #FF8C00 12px,
        transparent 12px,
        transparent 20px
      );
    }

    .header-top {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
      position: relative;
    }

    .logo-wrap {
      width: auto;
      display: flex;
      justify-content: flex-start;
      padding-left: 0;
    }

    .title-box {
      text-align: left;
    }

    .title-stack {
      align-items: flex-start;
    }

    .title-row {
      justify-content: flex-start;
    }

    .header-bottom {
      margin-right: 0;
      padding-right: 0;
      justify-content: flex-start;
    }

    /* ── LOGO ── */
    .word-secret {
      font-size: clamp(3.2rem, 15.3vw, 4.7rem);
    }

    .word-vending,
    .word-machine {
      font-size: clamp(1.5rem, 7.2vw, 2.4rem);
    }

    /* ── PRESS MARK — top-right corner, connected, 2.5x larger ── */
    .press-mark {
      position: absolute;
      top: 0;
      right: 0;
      margin-top: 0;
      grid-template-columns: repeat(4, 30px);
      grid-template-rows: repeat(2, 30px);
      width: auto;
      height: auto;
      gap: 0;
    }

    .press-mark span {
      width: 30px;
      height: 30px;
    }



    /* ── NAV ── */
    nav {
      justify-content: flex-end;
      gap: 0;
      align-items: stretch;
    }

    nav button {
      font-size: 0.6rem;
      padding: 0.4rem 0.5rem;
    }

    /* VEND — reduced 25%, flush right */
    .nav-zine {
      font-size: 0.78rem;
      padding: 0.54rem 0.8rem;
      border-radius: 0;
      align-self: stretch;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-vend {
      font-size: 0.78rem;
      padding: 0.54rem 0.96rem;
      letter-spacing: 0.18em;
      border-radius: 0;
      margin-left: auto;
      align-self: stretch;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 54px;
    }

    /* ── POST back button — hidden on mobile, date moves up ── */
    .post-back {
      display: none;
    }

    #page-post {
      padding-top: 0;
    }

    .post-dateline {
      margin-top: 0;
      padding-top: 0;
    }

    /* ── MAIN ── */
    main {
      padding: 1.5rem 1rem 4rem;
    }

    /* ── POST ── */
    .post-card {
      padding: 0;
      margin-bottom: 3.5rem;
    }

    .post-card h2 {
      font-size: 1.5rem;
      margin-top: 1rem;
    }

    /* On mobile the negative margin trick for full-bleed still works */
    .post-card .post-img {
      width: 100vw;
      max-width: 100vw;
      margin-left: calc(-50vw + 50%);
    }

    /* ── ABOUT PAGE ── */
    #page-about {
      margin: -1.5rem -1rem -4rem;
      width: calc(100% + 2rem);
    }

    .about-section {
      grid-template-columns: 1fr; /* single column on mobile */
      padding: 2.5rem 1.5rem 2.5rem 1.2rem;
      gap: 1rem;
    }

    .about-title-secret {
      font-size: clamp(2.3rem, 11.7vw, 3.9rem);
    }

    .about-title-vending {
      font-size: clamp(2rem, 10vw, 3.5rem);
    }

    /* Machine title: left-aligned on mobile, not right */
    .about-title-machine {
      font-size: clamp(1.4rem, 7vw, 2rem);
      text-align: left;
      color: #555;
      grid-column: 1;
      grid-row: auto;
    }

    .about-section-machine .about-body {
      grid-column: 1;
      grid-row: auto;
    }

    .about-colophon {
      padding: 2rem 1.5rem;
    }

    .submit-squares {
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: 1fr;
      height: 28px;
      gap: 2px;
      margin-bottom: 2rem;
    }

    /* Hide bottom 16 squares on mobile — show only first 8 */
    .submit-squares span:nth-child(n+9) {
      display: none;
    }

    .submit-heading {
      font-size: clamp(2rem, 10vw, 3.5rem);
    }

    /* ── ARCHIVE ── */
    .archive-item {
      flex-direction: column;
      gap: 0.3rem;
    }

    .arch-date {
      font-size: 0.58rem;
    }

    /* ── VEND MODAL ── */
    #vend-card {
      padding: 1.5rem;
    }
  }
</style>
</head>
<body>

<header>
  <div class="header-top">

    <div class="logo-wrap">
      <div class="title-box">
        <div class="title-stack">
          <div class="word word-secret">Secret</div>
          <div class="title-row">
            <div class="word word-vending">Vending</div>
            <div class="word word-machine">Machine</div>
          </div>
        </div>
      </div>

      <!-- Press mark: inside logo-wrap so mobile can tuck it under the base bar -->
      <div class="press-mark" aria-hidden="true">
        <span class="pm-1"></span>
        <span class="pm-2"></span>
        <span class="pm-3"></span>
        <span class="pm-4"></span>
        <span class="pm-5"></span>
        <span class="pm-6"></span>
        <span class="pm-7"></span>
        <span class="pm-8"></span>
      </div>

    </div>

  </div>
  <div class="header-bottom">
    <nav>
      <button class="nav-regular active" onclick="showPage('home')">Home</button>
      <button class="nav-regular" onclick="showPage('archive')">Archive</button>
      <button class="nav-regular" onclick="showPage('about')">About</button>
      <button class="nav-regular" onclick="showPage('submit')">Submit</button>
      <button class="nav-zine" onclick="window.open('zine.html', '_blank')">Zine</button>
      <button class="nav-vend" onclick="vend()">Vend</button>
    </nav>
  </div>
</header>

<main>

  <div id="page-home" class="page active">
    <div id="home-content"></div>
  </div>

  <div id="page-archive" class="page">
    <div class="page-header">
      <h1>Archive</h1>
      <div class="sub">stocked with care</div>
    </div>
    <div id="archive-list"></div>
  </div>

  <!-- Single post page — navigated to from archive -->
  <div id="page-post" class="page">
    <button class="post-back" onclick="showPage('archive')">&#8592; archive</button>
    <div id="post-content"></div>
  </div>

  <div id="page-about" class="page">
    <div class="about-content">

      <div class="about-section about-section-secret">
        <div class="about-title-secret">about</div>
        <div class="about-body">
          <p>Hit VEND: you get a random post from the archive.</p>
          <p>Hit SUBMIT: feed the machine.</p>
          <p style="margin-top:2rem;font-size:0.85rem;color:#666;">Note: Photos should be loaded to imgur at around a "medium" size. Don't go small or large. If I really like the photo and need it in another size and you provided your email, we'll figure it out together.</p>
        </div>
      </div>

      <!-- Closing mark — printer's colophon -->
      <div class="about-colophon">
        <span class="about-colophon-rule"></span>
        <span class="about-colophon-mark">&#9632;</span>
        <span class="about-colophon-rule"></span>
      </div>

    </div>
  </div>

  <div id="page-submit" class="page">

    <div class="success-msg" id="success-msg">THNX!</div>
    <div class="error-msg" id="error-msg">&#10007; Something went wrong. Try again.</div>

    <!-- Celebratory color grid -->
    <div class="submit-squares" aria-hidden="true">
      <span class="ss-1"></span><span class="ss-2"></span><span class="ss-3"></span><span class="ss-4"></span>
      <span class="ss-5"></span><span class="ss-6"></span><span class="ss-7"></span><span class="ss-8"></span>
      <span class="ss-9"></span><span class="ss-10"></span><span class="ss-11"></span><span class="ss-12"></span>
      <span class="ss-13"></span><span class="ss-14"></span><span class="ss-15"></span><span class="ss-16"></span>
      <span class="ss-17"></span><span class="ss-18"></span><span class="ss-19"></span><span class="ss-20"></span>
      <span class="ss-21"></span><span class="ss-22"></span><span class="ss-23"></span><span class="ss-24"></span>
    </div>

    <div class="submit-heading">submit<span>.</span></div>

    <p class="submit-intro">Come live in the machine. It's cozy in here.</p>

    <div class="form-group">
      <span class="field-num">01</span>
      <label for="sub-title">Title</label>
      <input type="text" id="sub-title" placeholder="type title here">
    </div>

    <div class="form-group">
      <span class="field-num">02</span>
      <label for="sub-body">Body</label>
      <textarea id="sub-body" placeholder="write words here"></textarea>
    </div>

    <div class="form-group">
      <span class="field-num">03</span>
      <label for="sub-img">image link (optional)</label>
      <input type="text" id="sub-img" placeholder="https://...">
      <div class="field-note">imgur.com works. paste the direct image link.</div>
    </div>

    <div class="form-group">
      <span class="field-num">04</span>
      <label for="sub-name">your name (optional)</label>
      <input type="text" id="sub-name" placeholder="anonymous is fine">
    </div>

    <div class="form-group">
      <span class="field-num">05</span>
      <label for="sub-email">email (optional)</label>
      <input type="email" id="sub-email" placeholder="only if you want to hear back">
    </div>

    <button class="btn-submit" id="submit-btn" onclick="submitToFormspree()">drop it in</button>

  </div>


<footer class="site-footer">also check out <a href="https://fallingspoon.com" target="_blank" rel="noopener">fallingspoon.com</a></footer>
</main>

<div id="vend-overlay">
  <div id="vend-card">
    <button id="close-vend" onclick="closeVend()">&#10005; close</button>
    <div class="vend-label">&#9679; Random Drop</div>
    <div id="vend-content"></div>
  </div>
</div>

<script>
  const FORMSPREE_ID = 'mkovpozy';

  // Version flag — increment this to force a full localStorage reset
  const SITE_VERSION = '40';
  if (localStorage.getItem('svm_v') !== SITE_VERSION) {
    localStorage.clear();
    localStorage.setItem('svm_v', SITE_VERSION);
    console.log('Cache cleared, version set to', SITE_VERSION);
  }

  // Static posts — hardcoded, never touched by localStorage
  const STATIC_POSTS = [
    { id: 309, title: 'dance w/me', date: '2026-03-01', body: '', img: '/images/3.jpg' },
    { id: 303, title: 'like a sando', date: '2026-03-02', body: '', img: '/images/7.jpg' },
    { id: 310, title: 'forbidden sledding', date: '2026-03-03', body: '', img: '/images/14.jpg' },
    { id: 420, title: 'fleurs', date: '2026-03-04', body: '', img: '/images/z6.jpg' },
    { id: 409, title: 'ensconced', date: '2026-03-05', body: '', img: '/images/x4.jpg' },
    { id: 408, title: 'fortress of fun', date: '2026-03-06', body: '', img: '/images/x3.jpg' },
    { id: 414, title: 'sneaky sailboat', date: '2026-03-07', body: '', img: '/images/x9.jpg' },
    { id: 311, title: 'i want this feeling in my heart today', date: '2026-03-08', body: '', img: '/images/16.jpg' },
    { id: 304, title: 'tiny and tall', date: '2026-03-09', body: '', img: '/images/15.jpg' },
    { id: 416, title: 'lean on the scene', date: '2026-03-10', body: '', img: '/images/z2.jpg' },
    { id: 405, title: 'north sky shining bright', date: '2026-03-11', body: '', img: '/images/c6.jpg' },
    { id: 412, title: 'tinged mango', date: '2026-03-12', body: '', img: '/images/x7.jpg' },
    { id: 407, title: 'blue coming through', date: '2026-03-13', body: '', img: '/images/x2.jpg' },
    { id: 402, title: 'back street sneak around', date: '2026-03-14', body: '', img: '/images/c3.jpg' },
    { id: 312, title: 'bounce me off the water', date: '2026-03-15', body: '', img: '/images/5.jpg' },
    { id: 418, title: 'something borrowed, something blue', date: '2026-03-16', body: '', img: '/images/z4.jpg' },
    { id: 419, title: 'whip it round', date: '2026-03-17', body: '', img: '/images/z5.jpg' },
    { id: 410, title: 'rocks plotting escape', date: '2026-03-18', body: '', img: '/images/x5.jpg' },
    { id: 313, title: 'wise warrior', date: '2026-03-19', body: '', img: '/images/12.jpg' },
    { id: 406, title: 'soft cross', date: '2026-03-20', body: '', img: '/images/x1.jpg' },
    { id: 404, title: 'floating in wait', date: '2026-03-21', body: '', img: '/images/c5.jpg' },
    { id: 415, title: 'patina pristine', date: '2026-03-22', body: '', img: '/images/z1.jpg' },
    { id: 421, title: 'jagged and dragging', date: '2026-03-23', body: '', img: '/images/z7.jpg' },
    { id: 413, title: 'can anybody fly this thing?', date: '2026-03-24', body: '', img: '/images/x8.jpg' },
    { id: 403, title: 'brutal corner of campus', date: '2026-03-25', body: '', img: '/images/c4.jpg' },
    { id: 400, title: 'subtle light in the north sky', date: '2026-03-26', body: '', img: '/images/c1.jpg' },
    { id: 423, title: 'hwhip it', date: '2026-03-27', body: '', img: '/images/z9.jpg' },
    { id: 417, title: 'not sure. is cool. 2.', date: '2026-03-28', body: '', img: '/images/z3.jpg' },
    { id: 302, title: 'dream in daytime means "daydream"', date: '2026-03-29', body: '', img: '/images/6.jpg' },
    { id: 300, title: 'be grate', date: '2026-03-30', body: '', img: '/images/8.jpg' },
    { id: 422, title: 'see you through', date: '2026-03-31', body: '', img: '/images/z8.jpg' },
    { id: 411, title: 'safe and sound', date: '2026-04-01', body: '', img: '/images/x6.jpg' },
    { id: 305, title: 'best of both worlds', date: '2026-04-02', body: '', img: '/images/11.jpg' },
    { id: 306, title: 'i thought it was the moon', date: '2026-04-03', body: '', img: '/images/13.jpg' },
    { id: 308, title: 'tucked away in paradise', date: '2026-04-04', body: '', img: '/images/2.jpg' },
    { id: 314, title: 'breeze beneath the trees', date: '2026-04-05', body: '', img: '/images/1.jpg' },
    { id: 315, title: 'zen din din', date: '2026-04-06', body: '', img: '/images/4.jpg' },
    { id: 401, title: 'dancing down the stairs', date: '2026-04-07', body: '', img: '/images/c2.jpg' },
    { id: 301, title: 'double eagle aka albatross in golf', date: '2026-04-08', body: '', img: '/images/10.jpg' },
    { id: 307, title: 'for ice cream?', date: '2026-04-09', body: '', img: '/images/9.jpg' },
    { id: 200, title: 'up in copper country', date: '2026-02-25', body: '', img: '/images/copper.jpg' },
    { id: 3, title: '2 2', date: '2025-08-18', body: '', img: '/images/doorsagain.jpg' },
    { id: 4, title: 'a dream within', date: '2025-08-19', body: '', img: '/images/gaolagainagain.jpg' },
    { id: 5, title: 'zig then zag', date: '2025-08-31', body: '', img: '/images/zagagain.jpg' },
    { id: 109, title: 'sky flying', date: '2025-09-04', body: '', img: '/images/eb746f97-21e2-403d-bba7-62ce472996e9.jpg' },
    { id: 111, title: 'birthday basics', date: '2025-09-11', body: '', img: '/images/e7f3468a-7532-4c1a-8e74-519f98637ffb.jpg' },
    { id: 112, title: 'at least a mile wide', date: '2025-09-17', body: '', img: '/images/e7b3aba5-5856-42da-80d9-07eac3fef0ee.jpg' },
    { id: 113, title: 'rainbow stairway', date: '2025-09-20', body: '', img: '/images/de73e2bc-be60-4ede-a44f-fb57c381e6c9.jpg' },
    { id: 116, title: 'morning mist explosion', date: '2025-09-24', body: '', img: '/images/d2cb2f93-2542-49b7-b678-fb3ee938e76b.jpg' },
    { id: 117, title: 'yesterday today', date: '2025-09-29', body: '', img: '/images/cc766f6c-a253-4f12-a6bc-174e04b89c67.jpg' },
    { id: 121, title: 'weeeee. Skeeball.', date: '2025-10-22', body: '', img: '/images/b5da5702-d5aa-4576-a671-45ad98d16631.jpg' },
    { id: 124, title: 'space is the place', date: '2025-11-02', body: '', img: '/images/9bc7c9e5-4c7b-43f0-ab21-792fbf727484.jpg' },
    { id: 125, title: 'free lil bee', date: '2025-11-03', body: '', img: '/images/950baa56-d1bc-431e-9a3e-15a0081ae006.jpg' },
    { id: 127, title: 'happy little psychadelic visions', date: '2025-11-08', body: '', img: '/images/914d0da6-f52f-4ed2-8f67-317f711b7b95.jpg' },
    { id: 128, title: 'purple park power', date: '2025-11-12', body: '', img: '/images/8eaf0b76-ace2-4a1e-b9b0-e51f696da14d.jpg' },
    { id: 131, title: 'where the dinosaurs roamed', date: '2025-11-30', body: '', img: '/images/8b43868b-006e-429c-a938-0ae68fa27468.jpg' },
    { id: 140, title: 'Please do not', date: '2025-12-31', body: '', img: '/images/628b898e-d6bb-4264-a7fc-67beccd8336c.jpg' },
    { id: 148, title: 'cuppa yo life', date: '2026-01-18', body: '', img: '/images/276be38a-1b52-4830-bb26-5d7e6ce2907e.jpg' },
    { id: 149, title: 'all aboard the wizard train', date: '2026-01-19', body: '', img: '/images/24210a7a-8e95-4b4e-a344-b2abd278c82c.jpg' },
    { id: 152, title: 'like only a midsummer morning', date: '2026-01-28', body: '', img: '/images/185c8b0f-c54d-46df-a141-f00c5d18cb17.jpg' },
    { id: 154, title: 'not sure. is cool.', date: '2026-01-30', body: '', img: '/images/166cba7e-8c23-4447-8515-eeb797fddb78.jpg' },
    { id: 155, title: 'lil bit of bear, lil bit of purp', date: '2026-02-07', body: '', img: '/images/13634443-cd8a-4d34-a63d-958202ec112e.png' },
    { id: 156, title: 'no, yr the goat', date: '2026-02-13', body: '', img: '/images/121a9ef7-c38a-45f5-8e72-c422d1114f00.jpg' },
    { id: 158, title: 'golden slumbers fill your eyes', date: '2026-02-20', body: '', img: '/images/07cdca41-f1c6-4d2f-a3e6-edae555cda86.jpg' }
  ];

  function getPosts() {
    try {
      const today = new Date().toISOString().slice(0, 10);
      const stored = JSON.parse(localStorage.getItem('svm_posts') || '[]');
      const staticIds = new Set(STATIC_POSTS.map(p => p.id));
      const userPosts = stored.filter(p => !staticIds.has(p.id));
      const all = [...STATIC_POSTS, ...userPosts];
      // Hide posts with future dates — scheduled content
      return all.filter(p => p.date <= today);
    }
    catch(e) {
      const today = new Date().toISOString().slice(0, 10);
      return STATIC_POSTS.filter(p => p.date <= today);
    }
  }

  function savePosts(posts) {
    localStorage.setItem('svm_posts', JSON.stringify(posts));
  }

  // addPost({ title: "...", date: "2026-02-22", body: "...", img: "" })
  function addPost(post) {
    const posts = getPosts();
    posts.push({ id: Date.now(), ...post });
    savePosts(posts);
    renderHome();
    renderArchive();
    console.log('Post added:', post.title);
  }

  // Text seed post removed

  function showPage(name) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('nav .nav-regular').forEach(b => b.classList.remove('active'));
    document.getElementById('page-' + name).classList.add('active');
    document.querySelectorAll('nav .nav-regular').forEach(b => {
      if (b.textContent.toLowerCase().trim() === name) b.classList.add('active');
    });
    if (name === 'home') renderHome();
    if (name === 'archive') renderArchive();
  }

  function renderHome() {
    const posts = getPosts().sort((a,b) => b.id - a.id);
    const el = document.getElementById('home-content');
    if (!posts.length) {
      el.innerHTML = '<div class="no-posts">Nothing yet.<div class="hint">Posts appear here once published.</div></div>';
      return;
    }
    el.innerHTML = renderPostCard(posts[0]);
  }

  function renderPostCard(post) {
    const imgHtml = post.img ? `<img class="post-img" src="${esc(post.img)}" alt="${esc(post.title)}">` : '';
    const titleHtml = post.title ? `<h2>${esc(post.title)}</h2>` : '';
    const bodyHtml = post.body ? `<div class="post-body">${esc(post.body)}</div>` : '';
    return `<div class="post-dateline"><span>${formatDate(post.date)}</span></div>
    <div class="post-card">
      ${titleHtml}
      ${imgHtml}
      ${bodyHtml}
    </div>`;
  }

  function renderArchive() {
    const posts = getPosts().sort((a,b) => b.date.localeCompare(a.date));
    const el = document.getElementById('archive-list');
    if (!posts.length) {
      el.innerHTML = '<div class="no-posts">The archive is empty.</div>';
      return;
    }
    el.innerHTML = posts.map(p => `
      <div class="archive-item" onclick="openPost(${p.id})">
        <div class="arch-title">${esc(p.title) || formatDate(p.date)}</div>
        <div class="arch-date">${formatDate(p.date)}</div>
      </div>`).join('');
  }

  function openPost(id) {
    const post = getPosts().find(p => p.id === id);
    if (!post) return;
    const imgHtml = post.img ? `<img class="post-img" src="${esc(post.img)}" alt="${esc(post.title)}">` : '';
    const titleHtml = post.title ? `<h2>${esc(post.title)}</h2>` : '';
    const bodyHtml = post.body ? `<div class="post-body">${esc(post.body)}</div>` : '';
    document.getElementById('post-content').innerHTML = `
      <div class="post-dateline"><span>${formatDate(post.date)}</span></div>
      <div class="post-card">
        ${titleHtml}
        ${imgHtml}
        ${bodyHtml}
      </div>`;
    showPage('post');
    window.scrollTo(0, 0);
  }

  async function submitToFormspree() {
    const title = document.getElementById('sub-title').value.trim();
    const body  = document.getElementById('sub-body').value.trim();
    if (!title || !body) { alert('Please include at least a title and body.'); return; }
    if (FORMSPREE_ID === 'YOUR_FORM_ID') {
      alert('Formspree is not configured yet. See the code comments for instructions.');
      return;
    }
    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.textContent = 'Sending...';
    const data = new FormData();
    data.append('name',      document.getElementById('sub-name').value);
    data.append('email',     document.getElementById('sub-email').value);
    data.append('title',     title);
    data.append('body',      body);
    data.append('image_url', document.getElementById('sub-img').value);
    try {
      const res = await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
        method: 'POST', body: data, headers: { 'Accept': 'application/json' }
      });
      if (res.ok) {
        document.getElementById('success-msg').style.display = 'block';
        document.getElementById('error-msg').style.display   = 'none';
        ['sub-name','sub-email','sub-title','sub-body','sub-img'].forEach(id => {
          document.getElementById(id).value = '';
        });
      } else { throw new Error(); }
    } catch(e) {
      document.getElementById('error-msg').style.display   = 'block';
      document.getElementById('success-msg').style.display = 'none';
    }
    btn.disabled = false;
    btn.textContent = 'Drop it in the machine';
  }

  // Shuffle queue — cycles through all posts before repeating
  let vendQueue = [];

  function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function vend() {
    const posts = getPosts();
    if (!posts.length) { alert('The machine is empty.'); return; }
    // Refill queue when empty
    if (vendQueue.length === 0) {
      vendQueue = shuffleArray(posts.map(p => p.id));
    }
    const id = vendQueue.pop();
    openPost(id);
  }

  function showModal(post) {
    const imgHtml = post.img ? `<img class="post-img" src="${esc(post.img)}" alt="${esc(post.title)}">` : '';
    document.getElementById('vend-content').innerHTML = `
      <div style="font-family:'Space Mono',monospace;font-size:.62rem;letter-spacing:.2em;color:var(--muted);text-transform:uppercase;margin-bottom:1.2rem;display:flex;align-items:center;gap:.6rem"><span style='display:block;width:16px;height:2px;background:#FF8C00;flex-shrink:0'></span>${formatDate(post.date)}</div>
      ${imgHtml}
      <h2 style="font-family:'DM Serif Display',serif;font-size:1.8rem;font-weight:400;margin-bottom:1.2rem;color:var(--white)">${esc(post.title)}</h2>
      <div style="font-size:1rem;line-height:1.8;color:#ccc;white-space:pre-wrap;word-break:break-word">${esc(post.body)}</div>`;
    document.getElementById('vend-overlay').classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeVend() {
    document.getElementById('vend-overlay').classList.remove('open');
    document.body.style.overflow = '';
  }

  document.getElementById('vend-overlay').addEventListener('click', function(e) {
    if (e.target === this) closeVend();
  });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeVend(); });

  function esc(s) {
    return String(s)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;')
      .replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function formatDate(d) {
    if (!d) return '';
    const [y,m,day] = d.split('-');
    const mon = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'][+m-1];
    return mon + ' ' + String(+day).padStart(2,'0');
  }

  renderHome();
</script>
</body>
</html>
